<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Assign Custom Messages</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/public/style.css" />
  <style>
    body {
      background: #f8fafc;
      font-family: "Segoe UI", Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 900px;
      margin: 2rem auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(60,72,100,0.12);
      padding: 2rem 2.5rem;
    }
    h1 {
      text-align: center;
      margin-bottom: 2rem;
      font-size: clamp(1.3rem, 4vw, 2.1rem);
      color: #2d3748;
      font-weight: 600;
    }
    form {
      width: 100%;
    }
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin-bottom: 2rem;
      background: #f8fafc;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(60,72,100,0.06);
    }
    th, td {
      padding: 0.9rem 0.7rem;
      border-bottom: 1px solid #e2e8f0;
      text-align: center;
      font-size: 1rem;
      vertical-align: middle;
    }
    th {
      background: #e0e7ef;
      color: #2d3748;
      font-weight: 500;
      font-size: 1.08rem;
      border-bottom: 2px solid #cbd5e1;
    }
    tbody tr:nth-child(even) {
      background: #f3f6fa;
    }
    tbody tr:hover {
      background: #e9edfa;
      transition: background 0.2s;
    }
    tr:last-child td {
      border-bottom: none;
    }
    textarea {
      width: 98%;
      min-height: 60px;
      border-radius: 8px;
      border: 1px solid #cbd5e1;
      padding: 0.5rem;
      font-size: 1rem;
      resize: vertical;
      background: #f8fafc;
      transition: border-color 0.2s, box-shadow 0.2s;
      margin: 0.2rem 0;
      box-sizing: border-box;
    }
    textarea:focus {
      border-color: #7f9cf5;
      box-shadow: 0 0 0 2px #c3dafe;
      outline: none;
    }
    button[type="submit"] {
      background: linear-gradient(90deg, #7f9cf5 0%, #667eea 100%);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 0.8rem 2.2rem;
      font-size: 1.08rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      margin: 0 auto;
      display: block;
      margin-top: 1.2rem;
      margin-bottom: 0.5rem;
    }
    button[type="submit"]:hover {
      background: linear-gradient(90deg, #667eea 0%, #7f9cf5 100%);
      transform: translateY(-2px) scale(1.03);
    }
    .back-link {
      display: inline-block;
      text-align: center;
      margin-top: 1.2rem;
      background: #7f9cf5;
      color: #fff;
      padding: 0.7rem 1.5rem;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 500;
      transition: background 0.2s, transform 0.1s;
    }
    .back-link:hover {
      background: #667eea;
      transform: translateY(-2px) scale(1.03);
    }
    @media (max-width: 900px) {
      .container {
        max-width: 98vw;
        padding: 1.2rem 0.5rem;
      }
      table, th, td {
        font-size: 0.97rem;
      }
    }
    @media (max-width: 600px) {
      .container {
        padding: 0.5rem 0.1rem;
        border-radius: 8px;
      }
      h1 {
        font-size: 1.1rem;
      }
      table, th, td {
        font-size: 0.93rem;
      }
      th, td {
        padding: 0.5rem 0.2rem;
      }
      .back-link, button[type="submit"] {
        width: 100%;
        box-sizing: border-box;
        font-size: 1rem;
        padding: 0.8rem 0;
      }
      textarea {
        min-height: 40px;
        font-size: 0.97rem;
      }
    }
    @media (max-width: 500px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }
      thead tr {
        display: none;
      }
      tbody tr {
        margin-bottom: 1.2rem;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(60,72,100,0.08);
        background: #fff;
        padding: 0.7rem 0.3rem;
      }
      td {
        border: none;
        position: relative;
        padding-left: 50%;
        text-align: left;
        min-height: 32px;
      }
      td:before {
        position: absolute;
        left: 0.7rem;
        top: 0.7rem;
        width: 45%;
        white-space: nowrap;
        font-weight: 600;
        color: #7f9cf5;
        font-size: 0.97rem;
      }
      td:nth-child(1):before { content: "Country Code"; }
      td:nth-child(2):before { content: "Number"; }
      td:nth-child(3):before { content: "Status"; }
      td:nth-child(4):before { content: "Custom Message"; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Assign Custom Messages to Numbers</h1>
    <form id="messagesForm" autocomplete="off">
      <table>
        <thead>
          <tr>
            <th>Country Code</th>
            <th>Number</th>
            <th>Status</th>
            <th>Custom Message</th>
          </tr>
        </thead>
        <tbody id="numbersTbody"></tbody>
      </table>
      <button type="submit">Save All Messages</button>
    </form>
    <a class="back-link" href="/admin">Back to Admin</a>
  </div>
  <script>
    async function loadNumbersAndMessages() {
      const numbers = await fetch('/api/numbers').then(r => r.json());
      const tbody = document.getElementById('numbersTbody');
      tbody.innerHTML = '';
      numbers.forEach((n, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${n.countryCode}</td>
          <td>${n.number}</td>
          <td>${n.status === 'active' ? 'Active' : 'Inactive'}</td>
          <td>
            <textarea name="msg_${i}" data-cc="${n.countryCode}" data-num="${n.number}">${n.message ? n.message : ''}</textarea>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    document.getElementById('messagesForm').onsubmit = async function(e) {
      e.preventDefault();
      const textareas = document.querySelectorAll('textarea');
      const messages = [];
      textareas.forEach(t => {
        messages.push({
          countryCode: t.getAttribute('data-cc'),
          number: t.getAttribute('data-num'),
          message: t.value
        });
      });
      await fetch('/api/messages', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(messages)
      });
      alert('Messages saved!');
    };

    loadNumbersAndMessages();
  </script>
</body>
</html>